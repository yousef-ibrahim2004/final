{% extends "base.html" %}
{% load static %}

{% block title %}{{ profile.user.username }}'s Profile - SocialHub{% endblock %}

{% block content %}
{% if profile.user.settings.profile_visibility == 'public' or user == profile.user %}

<h2 style="text-align:center; margin-bottom: 1rem;">{{ profile.user.username }}'s Profile</h2>

<div style="max-width: 600px; margin: auto; background: #f9f9f9; padding: 1.5rem; border-radius: 8px; box-shadow: 0 0 6px rgba(0,0,0,0.1);">
    <div style="text-align:center; margin-bottom: 1.5rem;">
        {% if profile.avatar %}
            <img src="{{ profile.avatar.url }}" alt="{{ profile.user.username }}'s Avatar" 
                 style="width:120px; height:120px; object-fit: cover; border-radius: 50%; border: 2px solid #007bff;">
        {% else %}
            <img src="{% static 'images/default_avatar.png' %}" alt="Default Avatar" 
                 style="width:120px; height:120px; border-radius: 50%; border: 2px solid #007bff;">
        {% endif %}
    </div>

    <p><strong>Username:</strong> {{ profile.user.username }}</p>

    {% if user == profile.user %}
        <p><strong>Email:</strong> {{ profile.user.email }}</p>
    {% endif %}

    {% if profile.bio %}
        <p><strong>Bio:</strong> {{ profile.bio|linebreaksbr }}</p>
    {% else %}
        <p><em>No bio provided.</em></p>
    {% endif %}

    {% if profile.location %}
        <p><strong>Location:</strong> {{ profile.location }}</p>
    {% endif %}

    <p><small>Member since: {{ profile.created_at|date:"F j, Y" }}</small></p>

    <!-- Followers / Following Section -->
    <div style="margin: 1rem 0; display:flex; justify-content:space-between; align-items:center;">
        <div>
            <a href="{% url 'accounts:followers_list' profile.user.id %}" style="text-decoration:none; color:#007bff; margin-right:1rem;">
                Followers: {{ profile.user.followers.count }}
            </a>
            <a href="{% url 'accounts:following_list' profile.user.id %}" style="text-decoration:none; color:#007bff;">
                Following: {{ profile.user.following.count }}
            </a>
        </div>

        {% if user.is_authenticated and user != profile.user %}
            <form action="{% url 'accounts:follow_toggle' profile.user.id %}" method="post" style="display:inline;">
                {% csrf_token %}
                {% if is_following %}
                    <button type="submit" style="padding:0.4rem 0.8rem; background:#dc3545; color:white; border:none; border-radius:4px;">
                        Unfollow
                    </button>
                {% else %}
                    <button type="submit" style="padding:0.4rem 0.8rem; background:#28a745; color:white; border:none; border-radius:4px;">
                        Follow
                    </button>
                {% endif %}
            </form>
        {% endif %}
    </div>

    {% if user == profile.user %}
    <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center;">
        <a href="{% url 'accounts:profile_edit' %}" 
           style="background: #007bff; color: white; padding: 0.5rem 1rem; border-radius: 5px; text-decoration: none;">
            Edit Profile
        </a>
        <a href="{% url 'accounts:profile_confirm_delete' profile.pk %}" 
           style="background: #dc3545; color: white; padding: 0.5rem 1rem; border-radius: 5px; text-decoration: none;">
            Delete Profile
        </a>
    </div>
    {% endif %}
</div>
{% else %}
<div style="max-width: 600px; margin: 2rem auto; background: #fff3f3; padding: 1.5rem; border-radius: 8px; box-shadow: 0 0 6px rgba(0,0,0,0.1); text-align: center;">
    <span style="font-size: 2rem;">ðŸš«</span>
    <h3 style="color: #b00020; margin-top: 0.5rem;">This profile is private</h3>
    <p style="color: #555; font-size: 0.9rem;">You do not have permission to view the details of this account.</p>
</div>
{% endif %}
{% endblock %}
